execution_plan:
  maximum_time: 120
  setup:
    script: /vagrant/schedules/bug_discovery/redis_setup/start_cluster.sh
    duration: 20
  workload:
    script: /vagrant/schedules/bug_discovery/redis_setup/start_workload.sh
  cleanup:
    script: /vagrant/schedules/bug_discovery/redis_setup/cleanup.sh
    duration: 5
  pre_workload:
    script: /vagrant/schedules/bug_discovery/redis_setup/init_cluster.sh
  tracer:
    functions_file: /vagrant/profiler/redis/functions.txt
    tracer_location: "/vagrant/tracer/target/release/tracer"
    pipe_location: "/tmp/containerpid"
    binary_to_examine: "/usr/local/bin/redis-server"
    tracing_type: sys_all_trace,container_controlled
nodes:
  node1:
    container: true
    script: /scripts/start_redis.sh
    ip: 172.38.0.11
  node2:
    container: true
    script: /scripts/start_redis.sh
    ip: 172.38.0.12
  node3:
    container: true
    script: /scripts/start_redis.sh
    ip: 172.38.0.13
faults:
  pause-node1-during-save:
    type: process_pause
    target: node1
    duration: 50000
    begin_conditions:
      - long_save_start:
          type: user_function
          symbol: "rdbSave"
          binary_location: "/usr/local/bin/redis-server"
          call_count: 1
  kill-node1-to_simulate_oom_crash:
    type: process_kill
    target: node1
    begin_conditions:
      - kill_during_alloc:
          type: user_function
          symbol: "zmalloc"
          binary_location: "/usr/local/bin/redis-server"
          call_count: 1
  fail-write-on-save:
    type: syscall
    target: node1
    details:
      name: write
      return_value: -1
    begin_conditions:
      - write_when_memory_low:
          type: file_syscall
          file_name: ".rdb"
          syscall_name: "write"
          call_count: 1
