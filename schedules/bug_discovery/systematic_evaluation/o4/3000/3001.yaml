execution_plan:
  maximum_time: 120
  setup:
    script: /vagrant/schedules/bug_discovery/redis_setup/start_cluster.sh
    duration: 20
  workload:
    script: /vagrant/schedules/bug_discovery/redis_setup/start_workload.sh
  cleanup:
    script: /vagrant/schedules/bug_discovery/redis_setup/cleanup.sh
    duration: 15
  pre_workload:
    script: /vagrant/schedules/bug_discovery/redis_setup/init_cluster.sh
  tracer:
    tracer_location: "/vagrant/tracer/target/release/tracer"
    pipe_location: "/tmp/containerpid"
    binary_to_examine: "/usr/local/bin/redis-server"
    tracing_type: sys_all_trace,container_controlled
nodes:
  node1:
    container: true
    script: /scripts/start_redis.sh
    ip: 172.38.0.11
  node2:
    container: true
    script: /scripts/start_redis.sh
    ip: 172.38.0.12
  node3:
    container: true
    script: /scripts/start_redis.sh
    ip: 172.38.0.13

faults:
  # "1":
  #   type: file_syscall
  #   target: node1
  #   begin_conditions:
  #     - "1":
  #         type: file_syscall
  #         syscall_name: write
  #         file_name: appendonly.aof
  #         call_count: 2

  "2":
    type: syscall
    target: node1
    details:
      name: write
      return_value: -1
    begin_conditions:
      - "2":
          type: file_syscall
          syscall_name: write
          file_name: dump.rdb
          call_count: 1

  "3":
    type: process_kill
    target: node2
    begin_conditions:
      - "3":
          type: time
          time: 5000

  "4":
    type: block_ips
    target: node3
    duration: 10000
    ips_out:
      - node2
    begin_conditions:
      - "4":
          type: syscall
          syscall_name: read
          call_count: 10

  "5":
    type: process_pause
    target: node1
    duration: 5000
    begin_conditions:
      - "5":
          type: syscall
          syscall_name: openat
          call_count: 1

  "6":
    type: syscall
    target: node2
    details:
      name: read
      return_value: -1
    begin_conditions:
      - "6":
          type: file_syscall
          syscall_name: read
          file_name: nodes.conf
          call_count: 2

  "7":
    type: block_ips
    target: node1
    duration: 10000
    ips_in:
      - node3
    begin_conditions:
      - "7":
          type: time
          time: 12000

  "8":
    type: process_kill
    target: node3
    begin_conditions:
      - "8":
          type: syscall
          syscall_name: write
          call_count: 30

  "9":
    type: process_pause
    target: node2
    duration: 10000
    begin_conditions:
      - "9":
          type: time
          time: 15000

  "10":
    type: syscall
    target: node3
    details:
      name: openat
      return_value: -1
    begin_conditions:
      - "10":
          type: file_syscall
          syscall_name: openat
          file_name: appendonly.aof
          call_count: 3
